---
layout: post
title: ê³µìš© ìŠ¤í¬ë¦½íŠ¸ ì œì‘ê¸°ğŸˆ - Addressable í¸
category: devlog
tags: [unity, CoreScript, Retrospective]
image: /assets/img/blog/unity/2025/CoreBanner05.png
description: >
  Unity í”„ë¡œì íŠ¸ì˜ ê³µìš©ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì œì‘í•˜ë©´ì„œ ì–´ë–»ê²Œ ë§Œë“¤ì—ˆëŠ”ì§€, ì–´ë–¤ ì ì— ì‹ ê²½ì¼ëŠ”ì§€ ì„¤ëª…í•˜ëŠ” ê¸€ì…ë‹ˆë‹¤.
comments: true
---

* this unordered seed list will be replaced by toc as unordered list
{:toc}

Unityì—ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ ë¡œë“œí•˜ë‹¤ ë³´ë©´ Addressable ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ê²Œ ë˜ëŠ”ë°, ì§€ê¸ˆê» ê·¸ëƒ¥ ëŒ€ì¶© ì‚¬ìš©í•´ë³´ë‹¤ê°€ ì¢€ ë” ê´€ë¦¬ë¥¼ í•  ìˆ˜ ìˆê²Œ ë§Œë“¤ì–´ë³´ì ì‹¶ì—ˆë‹¤. ê·¸ë˜ì„œ ì´ë²ˆì—ëŠ” ì°¸ì¡° ì¹´ìš´íŒ…, ì¤‘ë³µ ë¡œë“œ ë°©ì§€, ë””ë²„ê¹… ê¸°ëŠ¥ê¹Œì§€ ê°–ì¶˜ AddressableLoaderë¥¼ ë§Œë“¤ì–´ë³´ì•˜ë‹¤.

# ğŸ’¡ì˜ˆì‹œ
ê°„ë‹¨í•˜ê²Œ ë¨¼ì € ì‚¬ìš© ì˜ˆì‹œë¶€í„° ì†Œê°œí•´ë³´ìë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

```cs
public class GameManager : MonoBehaviour
{
    private CancellationTokenSource cts;

    async void Start()
    {
        cts = new CancellationTokenSource();

        // ë‹¨ì¼ ë¦¬ì†ŒìŠ¤ ë¡œë“œ
        var prefab = await AddressableLoader.Instance
            .LoadAssetAsync<GameObject>("Player_Prefab", cts.Token);

        // ë¼ë²¨ë¡œ ì—¬ëŸ¬ ë¦¬ì†ŒìŠ¤ ì¼ê´„ ë¡œë“œ
        var items = await AddressableLoader.Instance
            .LoadAssetsAsync<ItemData>("Item_Label", cts.Token);

        // í”„ë¦¬ë¡œë“œ (ë¯¸ë¦¬ ë¡œë”©)
        await AddressableLoader.Instance
            .PreloadByLabelAsync("Stage1_Assets", cts.Token);
    }

    void OnDestroy()
    {
        // ë¦¬ì†ŒìŠ¤ í•´ì œ
        AddressableLoader.Instance.Release("Player_Prefab");

        // ë˜ëŠ” ëª¨ë“  ë¦¬ì†ŒìŠ¤ ì¼ê´„ í•´ì œ
        AddressableLoader.Instance.ReleaseAll();

        cts?.Cancel();
        cts?.Dispose();
    }
}
```

ì´ë ‡ê²Œ ì‚¬ìš©í•˜ë©´ ëœë‹¤. 
ë‚´ë¶€ì ìœ¼ë¡œ ì°¸ì¡° ì¹´ìš´íŒ…, ì¤‘ë³µ ë¡œë“œ ë°©ì§€, ë””ë²„ê¹…ê¹Œì§€ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë˜ë„ë¡ ë§Œë“¤ì—ˆë‹¤.

# ğŸ“Š í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

```
AddressableLoader (Facade íŒ¨í„´)
â”œâ”€ AssetReferenceTracker
â”‚   â””â”€ ReferenceCounter
â”œâ”€ AssetLoadCache
â””â”€ AddressableDebugger
```

Facade íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ ë³µì¡í•œ ì„œë¸Œì‹œìŠ¤í…œë“¤ì„ AddressableLoaderë¼ëŠ” ë‹¨ì¼ ì¸í„°í˜ì´ìŠ¤ë¡œ ê°ìŒŒë‹¤.

# ğŸ“ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
## í•µì‹¬ ì»´í¬ë„ŒíŠ¸

###### AddressableLoader
ì „ì²´ Addressable ì‹œìŠ¤í…œì„ ê´€ë¦¬í•˜ëŠ” ì‹±ê¸€í†¤ ë§¤ë‹ˆì €. LazyMonoSingletonë¡œ êµ¬í˜„í•¨.
- ì—­í• : ì„œë¸Œì‹œìŠ¤í…œë“¤ì„ ì¡°í•©í•˜ì—¬ ë‹¨ì¼ ì¸í„°í˜ì´ìŠ¤ ì œê³µ
- ì£¼ìš” ê¸°ëŠ¥:
  - ë¦¬ì†ŒìŠ¤ ë¡œë“œ/í•´ì œ
  - ë¼ë²¨ ê¸°ë°˜ ì¼ê´„ ë¡œë“œ
  - í”„ë¦¬ë¡œë“œ
  - ë””ë²„ê¹… ì •ë³´ ì œê³µ

###### AssetReferenceTracker
Addressable ì—ì…‹ì˜ ì°¸ì¡° ì¹´ìš´íŒ…ì„ ê´€ë¦¬.
- ì—­í• : ì°¸ì¡° ì¹´ìš´íŠ¸ ê¸°ë°˜ ìë™ í•´ì œ
- ì£¼ìš” ê¸°ëŠ¥:
  - Add: ìƒˆ ì—ì…‹ ë“±ë¡ (ì°¸ì¡° 1ë¡œ ì‹œì‘)
  - Increase: ì°¸ì¡° ì¹´ìš´íŠ¸ ì¦ê°€
  - Decrease: ì°¸ì¡° ì¹´ìš´íŠ¸ ê°ì†Œ (0ì´ ë˜ë©´ ìë™ í•´ì œ)
  - TryGet: ê¸°ì¡´ í•¸ë“¤ ì¡°íšŒ
- ë‚´ë¶€ êµ¬ì¡°:
  - ReferenceCounter<string, AsyncOperationHandle>: ì°¸ì¡° ì¹´ìš´í„°
  - Dictionary<string, Type>: ì—ì…‹ íƒ€ì… ì •ë³´

###### AssetLoadCache
ì¤‘ë³µ ë¡œë“œë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•œ ë¡œë”© ì‘ì—… ìºì‹œ.
- ì—­í• : ë™ì¼ Addressë¥¼ ë™ì‹œ ë¡œë“œí•  ë•Œ ì‘ì—… ê³µìœ 
- ì£¼ìš” ê¸°ëŠ¥:
  - TryGet: ë¡œë”© ì¤‘ì¸ ì‘ì—… ì¡°íšŒ
  - Register: ë¡œë”© ì‘ì—… ë“±ë¡
  - Complete: ë¡œë”© ì™„ë£Œ í›„ ìºì‹œ ì œê±°
- ë‚´ë¶€ êµ¬ì¡°:
  - Dictionary<string, UniTask Object>: ë¡œë”© ì¤‘ì¸ ì‘ì—…ë“¤

###### AddressableDebugger
ë””ë²„ê¹… ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ê³  ì¶œë ¥í•œë‹¤.
- ì—­í• : ë¡œë“œëœ ë¦¬ì†ŒìŠ¤ ì •ë³´ ì œê³µ
- ì£¼ìš” ê¸°ëŠ¥:
  - GetLoadedAssets: ë¡œë“œëœ ëª¨ë“  ì—ì…‹ ì •ë³´ ë°˜í™˜
  - GetLoadedCount: ë¡œë“œëœ ì—ì…‹ ê°œìˆ˜
  - GetLoadingCount: ë¡œë”© ì¤‘ì¸ ì‘ì—… ê°œìˆ˜
  - PrintDebugInfo: ë””ë²„ê·¸ ì •ë³´ ì½˜ì†” ì¶œë ¥

---
# ğŸ”„ ë°ì´í„° íë¦„

###### ë¦¬ì†ŒìŠ¤ ë¡œë“œ í”„ë¡œì„¸ìŠ¤
1. `LoadAssetAsync<T>(address)` í˜¸ì¶œ
2. ì´ë¯¸ ë¡œë“œëœ ê²½ìš°?
   - Yes â†’ ì°¸ì¡° ì¹´ìš´íŠ¸ ì¦ê°€ í›„ ì¦‰ì‹œ ë°˜í™˜
   - No â†’ 3ë²ˆìœ¼ë¡œ
3. ë¡œë”© ì¤‘ì¸ ì‘ì—…ì´ ìˆëŠ” ê²½ìš°?
   - Yes â†’ í•´ë‹¹ ì‘ì—… ì™„ë£Œê¹Œì§€ ëŒ€ê¸° í›„ ì°¸ì¡° ì¦ê°€
   - No â†’ 4ë²ˆìœ¼ë¡œ
1.  ìƒˆë¡œ ë¡œë“œ
   - UniTaskCompletionSource ìƒì„±
   - AssetLoadCacheì— ë¡œë”© ì‘ì—… ë“±ë¡
   - Addressables.LoadAssetAsync() ì‹¤í–‰
   - ì„±ê³µ ì‹œ: AssetReferenceTrackerì— í•¸ë“¤ ì €ì¥ (ì°¸ì¡° 1)
   - ì™„ë£Œ í›„: AssetLoadCacheì—ì„œ ì œê±°

###### ë¦¬ì†ŒìŠ¤ í•´ì œ í”„ë¡œì„¸ìŠ¤
1. Release(address) í˜¸ì¶œ
2. AssetReferenceTracker.DecreaseReference()
3. ì°¸ì¡° ì¹´ìš´íŠ¸ ê°ì†Œ
4. ì°¸ì¡° ì¹´ìš´íŠ¸ê°€ 0ì´ ë˜ë©´?
   - Addressables.Release(handle) í˜¸ì¶œ
   - assetTypesì—ì„œ ì œê±°

---
# ğŸ¯ ì‹ ê²½ ì“´ ë¶€ë¶„

###### ì¤‘ë³µ ë¡œë“œ ë°©ì§€
ë™ì¼í•œ Addressë¥¼ ì—¬ëŸ¬ ê³³ì—ì„œ ë™ì‹œì— ë¡œë“œí•  ë•Œ, í•˜ë‚˜ì˜ ì‘ì—…ë§Œ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ ê³µìœ í•˜ë„ë¡ í–ˆë‹¤.

```cs
// ì´ë¯¸ ë¡œë”© ì¤‘ì¸ ì‘ì—…ì´ ìˆìœ¼ë©´ ëŒ€ê¸° (ì¤‘ë³µ ë¡œë“œ ë°©ì§€)
if (loadCache.TryGetLoadingTask(address, out var loadingTask))
{
    Log($"[AddressableLoader] ë¡œë”© ì¤‘ì¸ ì‘ì—… ëŒ€ê¸°: {address}");

    // ì´ë¯¸ ë¡œë”© ì¤‘ì´ë©´ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°
    var result = await loadingTask;

    // ë¡œë“œ ì™„ë£Œ í›„ ì°¸ì¡° ì¦ê°€
    referenceTracker.IncreaseReference(address);
    return result as T;
}

// ìƒˆë¡œ ë¡œë“œ
var taskCompletionSource = new UniTaskCompletionSource<UnityEngine.Object>();
loadCache.RegisterLoadingTask(address, taskCompletionSource.Task);
```

ì˜ˆë¥¼ ë“¤ì–´, ë™ì‹œì— 100ê°œì˜ ìŠ¤í¬ë¦½íŠ¸ê°€ ê°™ì€ ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•´ë„ ì‹¤ì œë¡œëŠ” 1ë²ˆë§Œ ë¡œë“œí•˜ê³  ë‚˜ë¨¸ì§€ëŠ” ê²°ê³¼ë¥¼ ê¸°ë‹¤ë ¸ë‹¤ê°€ ë°›ëŠ”ë‹¤.

###### ì°¸ì¡° ì¹´ìš´íŒ… ë©”ëª¨ë¦¬ ê´€ë¦¬
ReferenceCounterë¥¼ ì‚¬ìš©í•˜ì—¬ ì°¸ì¡° ì¹´ìš´íŠ¸ê°€ 0ì´ ë  ë•Œë§Œ ì‹¤ì œë¡œ í•´ì œí•œë‹¤.

```cs
public AssetReferenceTracker()
{
    // ì°¸ì¡° ì¹´ìš´íŠ¸ê°€ 0ì´ ë˜ë©´ Addressables.Release í˜¸ì¶œ
    referenceCounter = new ReferenceCounter<string, AsyncOperationHandle>(
        onReleaseCallback: (address, handle) =>
        {
            if (handle.IsValid())
            {
                Addressables.Release(handle);
                Log($"[AssetReferenceTracker] ë¦¬ì†ŒìŠ¤ ì‹¤ì œ í•´ì œ: {address}");
            }
            assetTypes.Remove(address);
        },
        logName: "AssetReferenceTracker"
    );
}
```

ë”°ë¼ì„œ ì—¬ëŸ¬ ê³³ì—ì„œ ê°™ì€ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ë”ë¼ë„, ëª¨ë“  ê³³ì—ì„œ Releaseë¥¼ í˜¸ì¶œí•´ì•¼ ì‹¤ì œë¡œ ë©”ëª¨ë¦¬ì—ì„œ í•´ì œëœë‹¤.

---
# ê²°ë¡ 
ì´ê²ƒì €ê²ƒ ë§ì´ ë°”ê¿”ê°€ë©´ì„œ ìƒê°í•´ë´¤ëŠ”ë° ì´ë ‡ê²Œ ë¦¬ì†ŒìŠ¤ë§Œ ë”± ê´€ë¦¬í•˜ê²Œ ë‘ëŠ”ê²Œ ê°€ì¥ ê¹”ë”í•œ ê²ƒ ê°™ë‹¤. ì‚¬ìš©í•˜ë©´ì„œ ë” ë°”ë€”ì§€ë„ ëª¨ë¥´ê² ì§€ë§Œ... ì¼ë‹¨ì€ ì´ë ‡ê²Œ ë‘ì.
