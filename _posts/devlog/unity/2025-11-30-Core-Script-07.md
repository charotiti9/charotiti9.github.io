---
layout: post
title: ê³µìš© ìŠ¤í¬ë¦½íŠ¸ ì œì‘ê¸°ğŸˆ - UI ì‹œìŠ¤í…œã„´ í¸
category: devlog
tags: [unity, CoreScript, Retrospective]
image: /assets/img/blog/unity/2025/CoreBanner07.png
description: >
  Unity í”„ë¡œì íŠ¸ì˜ ê³µìš©ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì œì‘í•˜ë©´ì„œ ì–´ë–»ê²Œ ë§Œë“¤ì—ˆëŠ”ì§€, ì–´ë–¤ ì ì— ì‹ ê²½ì¼ëŠ”ì§€ ì„¤ëª…í•˜ëŠ” ê¸€ì…ë‹ˆë‹¤.
comments: true
---

* this unordered seed list will be replaced by toc as unordered list
{:toc}

Unityì—ì„œ UIë¥¼ ê´€ë¦¬í•˜ë‹¤ ë³´ë©´ ëŠ˜ ëŠë¼ëŠ” ì ì´ ìˆëŠ”ë°... ë§¤ë²ˆ UIë¥¼ ìƒì„±í•˜ê³  íŒŒê´´í•˜ëŠ” ê³¼ì •ì´ ë³µì¡í•˜ê³ , ë ˆì´ì–´ ê´€ë¦¬ê°€ ë’¤ì£½ë°•ì£½ì´ ëœë‹¤ëŠ” ì ì´ë‹¤. ë”°ë¼ì„œ ì´ë¥¼ ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” UI ì‹œìŠ¤í…œì„ ë§Œë“¤ê¸°ë¡œ í–ˆë‹¤.

ë ˆì´ì–´ ê¸°ë°˜ìœ¼ë¡œ UIë¥¼ ê´€ë¦¬í•˜ê³ , ì˜¤ë¸Œì íŠ¸ í’€ë§, ì• ë‹ˆë©”ì´ì…˜ê¹Œì§€ í†µí•©ëœ UI ì‹œìŠ¤í…œì„ ì›í–ˆë‹¤. ë„ˆë¬´ ì´ˆë°˜ë¶€í„° ë°©ëŒ€í•œê°€ ì‹¶ê¸´ í•œë° ë‚˜ì¤‘ì— ê²°êµ­ ì¶”ê°€í•˜ê²Œ ë ê±°ë¼ì„œ ì´ˆë°˜ë¶€í„° ë¹¡ì„¸ê²Œ ì¡ê¸°ë„ í–ˆë‹¤.

UIManagerê°€ ëª¨ë“  UIì˜ ìƒëª…ì£¼ê¸°ë¥¼ ê´€ë¦¬í•˜ê³ , ë ˆì´ì–´ë³„ë¡œ ê¹”ë”í•˜ê²Œ ì •ë¦¬ë˜ë©°, í’€ë§ì„ í†µí•´ ì„±ëŠ¥ì„ ìµœì í™”í•˜ê³ , ì• ë‹ˆë©”ì´ì…˜ê¹Œì§€ ì§€ì›í•˜ëŠ” ì‹œìŠ¤í…œ. ì™€ ê¿ˆì˜ ì‹œìŠ¤í…œì´ë‹¤~
(ì°¸ê³ ë¡œ ì• ë‹ˆë©”ì´ì…˜ì€ ê³ ë¯¼í•˜ë‹¤ê°€ DoTweenì„ ì‚¬ìš©í•˜ê¸°ë¡œ í–ˆë‹¤.)

# ğŸ’¡ì˜ˆì‹œ
ê²Œì„ì— ì„¤ì • UIê°€ í•„ìš”í•˜ë‹¤ê³  í•´ë³´ì. ê·¸ëŸ´ ë•Œ ì´ë ‡ê²Œ ë¨¼ì € UI í´ë˜ìŠ¤ë¥¼ ë§Œë“ ë‹¤.

```cs
[PoolAddress("UI/SettingsUI")]  // Addressable Asset ì£¼ì†Œ
public class SettingsUI : UIBase
{
    public override UILayer Layer => UILayer.PopUp; // ë ˆì´ì–´ ì–´ë””ë¡œ í•  ì§€ ê²°ì •

    // í˜ì´ë“œ ì¸ ì• ë‹ˆë©”ì´ì…˜
    public override UIAnimation ShowAnimation =>
        new UIFadeAnimation(0f, 1f, 0.3f);

    // í˜ì´ë“œ ì•„ì›ƒ ì• ë‹ˆë©”ì´ì…˜
    public override UIAnimation HideAnimation =>
        new UIFadeAnimation(1f, 0f, 0.3f);

    public override async UniTask OnShowAsync(CancellationToken ct)
    {
        // UI í‘œì‹œ ì‹œ ì´ˆê¸°í™” ë¡œì§
        Debug.Log("ì„¤ì • UI í‘œì‹œ");
    }

    public override async UniTask OnHideAsync(CancellationToken ct)
    {
        // UI ìˆ¨ê¹€ ì‹œ ì •ë¦¬ ë¡œì§
        Debug.Log("ì„¤ì • UI ìˆ¨ê¹€");
    }
}
```

ì´í›„ ì‚¬ìš©í•  ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì´ ê°„ë‹¨í•˜ê²Œ ì‚¬ìš©í•œë‹¤.
```cs
// UI í‘œì‹œ (Dim íš¨ê³¼ì™€ í•¨ê»˜)
var settingsUI = await UIManager.Instance
    .ShowAsync<SettingsUI>(UILayer.PopUp, useDim: true, ct);

// UI ìˆ¨ê¹€
UIManager.Instance.Hide<SettingsUI>();
```

íƒ€ì… ì•ˆì „í•œ ë°ì´í„° ì „ë‹¬ë„ ê°€ëŠ¥í•˜ë‹¤.
```cs
public class CharacterData
{
    public string Name;
    public int Level;
}

public class CharacterUI : UIBase<CharacterData>
{
    public override UILayer Layer => UILayer.Overlay;

    public override void OnInitialize(CharacterData data)
    {
        // íƒ€ì… ì•ˆì „í•œ ë°ì´í„° ì´ˆê¸°í™”
        Debug.Log($"ìºë¦­í„°: {data.Name}, ë ˆë²¨: {data.Level}");
    }
}

// ì‚¬ìš©ì€ ì´ë ‡ê²Œ
var data = new CharacterData { Name = "ì „ì‚¬", Level = 50 };
await UIManager.Instance
    .ShowAsync<CharacterUI, CharacterData>(UILayer.Overlay, data, ct);
```

# ğŸ“Š í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

```
UIManager (ì‹±ê¸€í†¤)
â”œâ”€ UICanvas: ë ˆì´ì–´ë³„ ê´€ë¦¬
â”œâ”€ UIResolutionHandler: í•´ìƒë„ ë³€ê²½ ê°ì§€
â””â”€ UIStack: ë’¤ë¡œê°€ê¸° ê¸°ëŠ¥

IPoolable (ì¸í„°í˜ì´ìŠ¤)
    â†‘ implements
UIBase / UIBase<TData>(ì¶”ìƒ í´ë˜ìŠ¤)
    â””â”€ ìƒëª…ì£¼ê¸° ë©”ì„œë“œ (OnShowAsync, OnHideAsync)

Effect (ì´í™íŠ¸)
â”œâ”€ UIAnimation: í˜ì´ë“œ, ìŠ¬ë¼ì´ë“œ, ìŠ¤ì¼€ì¼, ì‹œí€€ìŠ¤
â””â”€ UIDimController: ë ˆì´ì–´ë³„ Dim íš¨ê³¼

Utilities (ìœ í‹¸ë¦¬í‹°)
â”œâ”€ UIInputBlocker (ì‹±ê¸€í†¤) : ì…ë ¥ ì°¨ë‹¨ (ì¤‘ì²© ì§€ì›)
â”œâ”€ UICoordinateConverter (static): ì¢Œí‘œ ë³€í™˜
â””â”€ UISafeAreaHandler (ì»´í¬ë„ŒíŠ¸): Safe Area ëŒ€ì‘
```

UI ë ˆì´ì–´ëŠ” ì´ë ‡ê²Œ ë‘ê¸°ë¡œ í–ˆë‹¤
```
UILayer (Enum)
â”œâ”€ Background (0)
â”œâ”€ HUD (1)
â”œâ”€ Overlay (2)
â”œâ”€ PopUp (3)
â”œâ”€ System (4)
â””â”€ Transition (5)
```

# ğŸ“ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
## í•µì‹¬ ì»´í¬ë„ŒíŠ¸

###### UIManager (ì‹±ê¸€í†¤ ë§¤ë‹ˆì €)
- ì—­í• : ëª¨ë“  UIì˜ ìƒëª…ì£¼ê¸°ë¥¼ ì¤‘ì•™ì—ì„œ ê´€ë¦¬
- ì£¼ìš” ê¸°ëŠ¥: ì‚¬ìš©ìì—ê²Œ ì œê³µí•  public í•¨ìˆ˜ë“¤
  - UI ìƒì„±/í‘œì‹œ/ìˆ¨ê¹€
  - PoolManagerì™€ í†µí•© (UI ì¬ì‚¬ìš© ê´€ë ¨)
  - ë ˆì´ì–´ë³„ Canvas ê´€ë¦¬
  - ë’¤ë¡œê°€ê¸° ìŠ¤íƒ ê´€ë¦¬
  - ì”¬ ì „í™˜ ì‹œ ìë™ ì •ë¦¬
- ì´ˆê¸°í™” ë°©ë²•:
  ```cs
  // ê²Œì„ ì‹œì‘ ì‹œ ëª…ì‹œì  ì´ˆê¸°í™”
  await UIManager.CreateAsync(cancellationToken);
  ```

###### UIBase / UIBase(ì œë„¤ë¦­ TData)
- ì—­í• : ëª¨ë“  UIì˜ ë² ì´ìŠ¤ í´ë˜ìŠ¤
- ì£¼ìš” ê¸°ëŠ¥:
  - IPoolable êµ¬í˜„ (í’€ë§ ì§€ì›)
  - ìƒëª…ì£¼ê¸° ë©”ì„œë“œ (OnShowAsync, OnHideAsync)
  - ì• ë‹ˆë©”ì´ì…˜ ì§€ì› (ShowAnimation, HideAnimation)
  - íƒ€ì… ì•ˆì „í•œ ë°ì´í„° ì´ˆê¸°í™” (ì œë„¤ë¦­ ë²„ì „)
  - CancellationTokenìœ¼ë¡œ ìƒëª…ì£¼ê¸° ê´€ë¦¬
- ìƒëª…ì£¼ê¸°:
  1. OnInitialize (ìµœì´ˆ 1íšŒ)
  2. OnShowAsync (í‘œì‹œ ì‹œë§ˆë‹¤)
  3. ShowAnimation
  4. OnHideAsync (ìˆ¨ê¹€ ì‹œ)
  5. HideAnimation

###### UICanvas
- ì—­í• : MainCanvas ê¸°ë°˜ ë ˆì´ì–´ë³„ GameObject ê´€ë¦¬
- êµ¬ì¡°:
  - MainCanvas (Canvas ì»´í¬ë„ŒíŠ¸)
    - Background (RectTransform): ë°°ê²½ UI
    - HUD (RectTransform): ê²Œì„í”Œë ˆì´ ì¤‘ í•­ìƒ í‘œì‹œë˜ëŠ” ì •ë³´
    - Overlay (RectTransform): ë©”ì¸ ë©”ë‰´, ì¸ë²¤í† ë¦¬ ë“±
    - PopUp (RectTransform): íŒì—… ì°½ (ë’¤ë¡œê°€ê¸° ìŠ¤íƒ ì§€ì›)
    - System (RectTransform): í† ìŠ¤íŠ¸ ë©”ì‹œì§€, ì•Œë¦¼
    - Transition (RectTransform): ë¡œë”© í™”ë©´, ì”¬ ì „í™˜
- íŠ¹ì§•:
  - ëª¨ë“  ë ˆì´ì–´ê°€ í•˜ë‚˜ì˜ Canvasë¥¼ ê³µìœ  (Canvas ì¤‘ë³µX)
  - ë ˆì´ì–´ë³„ GameObjectë¡œ ê¹Šì´ ê´€ë¦¬
  - Addressableë¡œ MainCanvas ë¡œë“œ

###### UIStack
- ì—­í• : ë’¤ë¡œê°€ê¸° ê¸°ëŠ¥ (PopUp ë ˆì´ì–´)
- ì£¼ìš” ê¸°ëŠ¥:
  - List ê¸°ë°˜ Stack (Remove ì—°ì‚° íš¨ìœ¨ì )
  - Push/Pop/Peek
  - ì¤‘ë³µ ë°©ì§€
  - ESC í‚¤ ì²˜ë¦¬

###### UIDimController
- ì—­í• : ë°°ê²½ ì–´ë‘¡ê²Œ í•˜ê¸°
- ì£¼ìš” ê¸°ëŠ¥:
  - ë ˆì´ì–´ë³„ ë…ë¦½ Dim ê´€ë¦¬
  - UI Stack ì§€ì› (ì¤‘ì²© íŒì—…)
  - í˜ì´ë“œ ì• ë‹ˆë©”ì´ì…˜
  - Dim GameObject ë™ì  ìƒì„±
- ë™ì‘ ë°©ì‹:
  - ShowDimAsync: ê²€ì€ìƒ‰ Imageë¥¼ UI ë’¤ì— ìƒì„±
  - HideDimAsync: í˜ì´ë“œ ì•„ì›ƒ í›„ ì œê±°
  - UI Stack ì¶”ì í•˜ì—¬ ì¤‘ì²© íŒì—… ì§€ì›

###### UIAnimation (ì¶”ìƒ í´ë˜ìŠ¤)
DOTween ê¸°ë°˜ ì• ë‹ˆë©”ì´ì…˜ ì‹œìŠ¤í…œ.
- UIFadeAnimation: í˜ì´ë“œ ì¸/ì•„ì›ƒ (CanvasGroup ì•ŒíŒŒ)
- UISlideAnimation: ìŠ¬ë¼ì´ë“œ (Up, Down, Left, Right)
- UIScaleAnimation: ìŠ¤ì¼€ì¼ ì• ë‹ˆë©”ì´ì…˜
- UISequenceAnimation: ì—¬ëŸ¬ ì• ë‹ˆë©”ì´ì…˜ ìˆœì°¨ ì¬ìƒ
- ëª¨ë“  ì• ë‹ˆë©”ì´ì…˜ì€ CancellationToken ì§€ì›

###### UIInputBlocker (ì‹±ê¸€í†¤)
- ì—­í• : UI ì „í™˜ ì¤‘ ì…ë ¥ ì°¨ë‹¨
- ì£¼ìš” ê¸°ëŠ¥:
  - ì¤‘ì²© ì°¨ë‹¨ ì§€ì› (Block/Unblock ì¹´ìš´íŠ¸)
  - ì „ì²´ í™”ë©´ì„ ë®ëŠ” íˆ¬ëª…í•œ íŒ¨ë„
  - ìµœìƒìœ„ ë ˆì´ì–´ (Transition)ì— ë°°ì¹˜
  - LazyMonoSingletonìœ¼ë¡œ ìë™ ìƒì„±

---
# ğŸ”„ ë°ì´í„° íë¦„

###### ì´ˆê¸°í™” ë‹¨ê³„
1. ê²Œì„ ì‹œì‘ ì‹œ UIManager.CreateAsync() í˜¸ì¶œ  
   â†“
2. MainCanvasë¥¼ Addressableì—ì„œ ë¡œë“œ
3. UICanvas ì´ˆê¸°í™” (ë ˆì´ì–´ë³„ RectTransform ë§¤í•‘)
4. UIDimController, UIStack ìƒì„±
5. UIInputBlocker ìµœìƒìœ„ Canvas ì„¤ì •
6. ì”¬ ì „í™˜ ì´ë²¤íŠ¸ ë“±ë¡  
   â†“
7. \[ì™„ë£Œ] UIManager ì‚¬ìš© ê°€ëŠ¥

###### UI í‘œì‹œ í”„ë¡œì„¸ìŠ¤
1. UIManager.ShowAsync() í˜¸ì¶œ
   â†“
2. \[UIInputBlocker] ì…ë ¥ ì°¨ë‹¨ (ë‹¤ ë§Œë“¤ë•Œê¹Œì§€ ì…ë ¥ì°¨ë‹¨)
3. \[PoolManager] UI ì¸ìŠ¤í„´ìŠ¤ íšë“ (ì—†ìœ¼ë©´ Addressable ë¡œë“œ)
4. \[UICanvas] í•´ë‹¹ ë ˆì´ì–´ì˜ Transformìœ¼ë¡œ ì´ë™
5. \[activeUIs] Dictionaryì— ë“±ë¡  
   â†“
6. \[UIDimController] Dim í‘œì‹œ (useDim=trueì¸ ê²½ìš°)
   - ê²€ì€ìƒ‰ Imageë¥¼ UI ë’¤ì— ìƒì„±
   - í˜ì´ë“œ ì¸ ì• ë‹ˆë©”ì´ì…˜ (0 â†’ 0.7)  
   â†“
1. \[UIBase] ShowInternalAsync() í˜¸ì¶œ
   - OnInitialize() (ìµœì´ˆ 1íšŒë§Œ)
   - SetActive(true)
   - OnShowAsync() (ì»¤ìŠ¤í…€ ë¡œì§ ì‹¤í–‰)
   - ShowAnimation ì¬ìƒ (í˜ì´ë“œ/ìŠ¬ë¼ì´ë“œ/ìŠ¤ì¼€ì¼ ë“±)  
   â†“
1. \[UIStack] PopUp ë ˆì´ì–´ë©´ Stackì— ì¶”ê°€
2. \[UIInputBlocker] ì…ë ¥ ì°¨ë‹¨ í•´ì œ  
   â†“
3. \[ì™„ë£Œ] UI ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜

###### UI ìˆ¨ê¹€ í”„ë¡œì„¸ìŠ¤
11. UIManager.Hide() í˜¸ì¶œ  
    â†“
12. \[UIInputBlocker] ì…ë ¥ ì°¨ë‹¨ (ë‹¤ ì‚¬ë¼ì§ˆë•Œê¹Œì§€ ì…ë ¥ì°¨ë‹¨)
13. \[UIStack] Stackì—ì„œ ì œê±°
14. \[UIBase] HideInternalAsync() í˜¸ì¶œ
    - OnHideAsync() (ì •ë¦¬ ë¡œì§)
    - HideAnimation ì¬ìƒ (ì¦‰ì‹œ ìˆ¨ê¹€ì´ ì•„ë‹Œ ê²½ìš°)
    - SetActive(false)  
    â†“
15. \[activeUIs] Dictionaryì—ì„œ ì œê±°
16. \[PoolManager] í’€ë¡œ ë°˜í™˜ (ì¬ì‚¬ìš© ëŒ€ê¸°)
17. \[UIDimController] Dim ìˆ¨ê¹€
    - UI Stack í™•ì¸
    - ë‹¤ë¥¸ UIê°€ ìˆìœ¼ë©´ Dim ì´ë™
    - ì—†ìœ¼ë©´ í˜ì´ë“œ ì•„ì›ƒ í›„ ì œê±°  
    â†“
18. \[UIInputBlocker] ì…ë ¥ ì°¨ë‹¨ í•´ì œ
19. \[ì™„ë£Œ] UI ìˆ¨ê¹€ ì™„ë£Œ

---
# ğŸ¯ ì‹ ê²½ ì“´ ë¶€ë¶„

###### ë ˆì´ì–´ ì‹œìŠ¤í…œ
6ê°œì˜ ë ˆì´ì–´ë¡œ UI ê¹Šì´ë¥¼ ëª…í™•í•˜ê²Œ ê´€ë¦¬
- Enumìœ¼ë¡œ íƒ€ì… ì•ˆì „
- ìˆ«ìê°€ í´ìˆ˜ë¡ ìƒìœ„ ë ˆì´ì–´
- í•˜ë‚˜ì˜ Canvasì— ë ˆì´ì–´ë³„ GameObject
```cs
public enum UILayer
{
    Background = 0,  // ë°°ê²½
    HUD = 1,         // ê²Œì„í”Œë ˆì´ ì •ë³´
    Overlay = 2,     // ì¼ë°˜ UI
    PopUp = 3,       // íŒì—…
    System = 4,      // ì•Œë¦¼
    Transition = 5   // ì”¬ ì „í™˜
}
```

###### UI Stack (ë’¤ë¡œê°€ê¸° ê¸°ëŠ¥)
PopUp ë ˆì´ì–´ì—ì„œ ESC í‚¤ë¡œ ë’¤ë¡œê°€ê¸°ë¥¼ ì§€ì›
- List ê¸°ë°˜ Stack (ì¤‘ê°„ ì œê±° íš¨ìœ¨ì )
- Pop() ì‹œ ìµœìƒë‹¨ UI ë°˜í™˜
- UIManager.HandleBackKey()ë¡œ ê°„ë‹¨í•˜ê²Œ ì‚¬ìš©
```cs
public void HandleBackKey()
{
    UIBase ui = uiStack.Pop();
    if (ui != null)
    {
        HideUIAsync(ui, false, CancellationToken.None).Forget();
    }
}
```

###### Dim íš¨ê³¼ (ì¤‘ì²© íŒì—… ì§€ì›)
UIDimControllerê°€ UI Stackì„ ì¶”ì í•˜ì—¬ ì¤‘ì²©ëœ íŒì—…ì—ì„œë„ ì˜¬ë°”ë¥´ê²Œ ë™ì‘
```cs
// UI Stack ê´€ë¦¬
private readonly Dictionary<UILayer, List<UIBase>> dimUIStacks;

// UI ë‹«ì„ ë•Œ ìŠ¤íƒ í™•ì¸
if (stack.Count > 0)
{
    // ì´ì „ UI ì•„ë˜ë¡œ Dim ì´ë™
    UIBase prevUI = stack[stack.Count - 1];
    dimTransform.SetSiblingIndex(prevUI.transform.GetSiblingIndex() - 1);
}
else
{
    // ìŠ¤íƒì´ ë¹„ì—ˆìœ¼ë©´ Dim ìˆ¨ê¹€
    await HideDimCompletelyAsync(layer, ct);
}
```

###### ì…ë ¥ ì°¨ë‹¨ (ì¤‘ì²© ì°¨ë‹¨ ì§€ì›)
UIInputBlockerê°€ ì¤‘ì²© ì°¨ë‹¨ì„ ì§€ì›í•˜ì—¬ ì—¬ëŸ¬ UIê°€ ë™ì‹œì— ì „í™˜ë˜ì–´ë„ ì•ˆì „
```cs
private int blockCount = 0;

public void Block()
{
    blockCount++;
    if (blockCount == 1)
    {
        CreateBlocker();  // ìµœì´ˆ 1íšŒë§Œ ìƒì„±
    }
}

public void Unblock()
{
    if (blockCount > 0)
    {
        blockCount--;
    }
    if (blockCount == 0)
    {
        DestroyBlocker();  // ëª¨ë“  ì°¨ë‹¨ í•´ì œ ì‹œ ì œê±°
    }
}
```


###### íƒ€ì… ì•ˆì „í•œ ì œë„¤ë¦­ API
UIBase ì œë„¤ë¦­ìœ¼ë¡œ íƒ€ì… ì•ˆì „í•œ ë°ì´í„° ì „ë‹¬ì„ ì§€ì›
```cs
// ì œë„¤ë¦­ ë²„ì „
public abstract class UIBase<TData> : UIBase where TData : class
{
    public virtual void OnInitialize(TData data) { }

    // object ë²„ì „ì„ sealedë¡œ ë§‰ê³  ì œë„¤ë¦­ ë²„ì „ìœ¼ë¡œ ë³€í™˜
    public sealed override void OnInitialize(object data)
    {
        if (data is TData typedData)
        {
            OnInitialize(typedData);
        }
    }
}
```

---
# ê²°ë¡ 
êµ¬í˜„í•  ë¶€ë¶„ì´ ì»¤ì„œ ì• ë¨¹ì—ˆë‹¤. ì´ì •ë„ë©´ ì“¸ë§Œí•˜ê² ì§€!? ë³µì¡í•´ì§„ ê²ƒ ê°™ê¸´í•˜ì§€ë§Œ í•„ìš”í–ˆë‹¤ê³  ìƒê°í•œë‹¤. 
