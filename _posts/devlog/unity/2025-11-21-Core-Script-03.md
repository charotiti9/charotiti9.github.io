---
layout: post
title: ê³µìš© ìŠ¤í¬ë¦½íŠ¸ ì œì‘ê¸°ğŸˆ - GameFlow í¸
category: devlog
tags: [unity, CoreScript, Retrospective]
image: /assets/img/blog/unity/2025/CoreBanner03.png
description: >
  Unity í”„ë¡œì íŠ¸ì˜ ê³µìš©ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì œì‘í•˜ë©´ì„œ ì–´ë–»ê²Œ ë§Œë“¤ì—ˆëŠ”ì§€, ì–´ë–¤ ì ì— ì‹ ê²½ì¼ëŠ”ì§€ ì„¤ëª…í•˜ëŠ” ê¸€ì…ë‹ˆë‹¤.
comments: true
---

* this unordered seed list will be replaced by toc as unordered list
{:toc}

ìœ ë‹ˆí‹° ê²Œì„ì„ ë§Œë“¤ë‹¤ë³´ë©´ ëŠ˜ ëŠë¼ëŠ” ì ì´ ìˆëŠ”ë°... Unityì˜ ì‹¤í–‰ ìˆœì„œì˜ ë¶ˆí™•ì‹¤ì„± ë•Œë¬¸ì— ëŠ˜ ê³ ìƒí•œë‹¤ëŠ” ì ì´ë‹¤. ë”°ë¼ì„œ ì´ë¥¼ í†µí•©í•  ìˆ˜ ìˆëŠ” GameFlowManagerë¥¼ ë§Œë“¤ê¸°ë¡œ í–ˆë‹¤.
ì¤‘ì•™ ì§‘ì¤‘ì‹ ê²Œì„ í”Œë¡œìš° ê´€ë¦¬ ì‹œìŠ¤í…œì´ë¼ê³  ë©‹ìˆê²Œ ì´ë¦„ë¶™ì—¬ë³´ì.

# ğŸ’¡ì˜ˆì‹œ
ê°„ë‹¨í•˜ê²Œ ë¨¼ì € ì‚¬ìš© ì˜ˆì‹œë¶€í„° ì†Œê°œí•´ë³´ìë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

```cs
public class Player : UpdatableBase
  {
      public override int UpdateOrder => 100;  // ì‹¤í–‰ ìˆœì„œ

      public void Initialize()
      {
          Register();  // GameFlowManagerì— ë“±ë¡
      }

      public override void OnUpdate(float deltaTime)
      {
          // í”Œë ˆì´ì–´ ë¡œì§
      }
  }
```

```cs
public class Execute : MonoBehaviour
  {
      private Player player;

      void Awake()
      {
          // ê°ì²´ ìƒì„± ë° ì´ˆê¸°í™”
          player = new Player();
          player.Initialize();  // GameFlowManagerì— ìë™ ë“±ë¡

          // ì´ì œ GameFlowManagerê°€ ì•Œì•„ì„œ ìˆœì„œëŒ€ë¡œ ì—…ë°ì´íŠ¸!
      }

      void OnDestroy()
      {
          // ì •ë¦¬
          player?.Dispose();
      }
  }
```

ì´ë ‡ê²Œ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ìŒ ì•„ì§ ì´í•´ê°€ ì•ˆê°ˆ ìˆ˜ë„ ìˆê² ì§€ë§Œ ì•„ë˜ì˜ ì„¤ëª…ì„ ë³´ë©´ ëª…í™•í•´ì§ˆ ê²ƒì´ë¼ ë¯¿ëŠ”ë‹¤.

# ğŸ“Š í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨
```
  GameFlowManager (ì‹±ê¸€í†¤)
  â”œâ”€ Update Loop
  â”œâ”€ FixedUpdate Loop
  â””â”€ LateUpdate Loop
```
Game Flow Managerê°€ í•˜ìœ„ì˜ Updateë“¤ì„ ë³´ê³  ìˆœì°¨ ì‹¤í–‰í•˜ëŠ” êµ¬ì¡°ë‹¤.
ë§ë‹¤ ì‚¬ì‹¤ ë³„ê±° ì—†ë‹¤.

# ğŸ“ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
## í•µì‹¬ ì»´í¬ë„ŒíŠ¸

###### ì¸í„°í˜ì´ìŠ¤ ê³„ì¸µ
IUpdatable, IFixedUpdatable, ILateUpdatable ì„¸ ê°€ì§€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•œë‹¤.
ê° ì¸í„°í˜ì´ìŠ¤ëŠ” ë³´ë©´ ì•Œê² ì§€ë§Œ ê°ê° ìœ ë‹ˆí‹°ì˜ Update, FIxedUpdate, LateUpdateë¥¼ ì‹¤í–‰í•˜ë„ë¡ ë˜ì–´ìˆë‹¤.

###### Base í´ë˜ìŠ¤ ê³„ì¸µ
ì¸í„°í˜ì´ìŠ¤ ê³„ì¸µì„ ìƒì†ë°›ì•„ì„œ êµ¬í˜„ëœ ë² ì´ìŠ¤ í´ë˜ìŠ¤ì´ë‹¤.
UpdatableBase, FixedUpdatableBase, LateUpdatableBase ì„¸ ê°€ì§€ Base í´ë˜ìŠ¤ê°€ ìˆê³ ,
ì•„ë˜ì˜ ê¸°ëŠ¥ì„ ê°€ì§€ê³  ìˆë‹¤
- int UpdateOrder:  ì‹¤í–‰ ìš°ì„ ìˆœìœ„ë¥¼ ì •ì˜(ë‚®ì€ ê°’ì¼ìˆ˜ë¡ ë¨¼ì € ì‹¤í–‰)
- Register(): Initializeë“±ì—ì„œ í˜¸ì¶œí•˜ì—¬ GameFlowManagerì—ê²Œ ë“±ë¡í•œë‹¤
- Unregister(): Dispose()ì—ì„œ ìë™ìœ¼ë¡œ í˜¸ì¶œë˜ë©° GameFlowManagerì—ê²Œì„œ í•´ì œëœë‹¤
- OnUpdate/OnFixedUpdate/OnLateUpdate: ìƒì†ë°›ëŠ” í´ë˜ìŠ¤ì—ì„œ í•„ìˆ˜ë¡œ êµ¬í˜„í•œë‹¤
- Dispose(): ë°˜ë“œì‹œ í˜¸ì¶œí•´ì•¼í•˜ëŠ” ë©”ì†Œë“œì´ë©°, í˜¸ì¶œí•˜ì§€ ì•Šì•˜ì„ ë•Œ ê²½ê³  í‘œì‹œí•œë‹¤
- OnDispose(): ìƒì†ë°›ëŠ” í´ë˜ìŠ¤ì—ì„œ ì„ íƒì ìœ¼ë¡œ êµ¬í˜„í•œë‹¤

###### GameFlowManager
Base í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì€ íŒŒìƒ í´ë˜ìŠ¤ë“¤ì„ ëª¨ì•„ì„œ ê´€ë¦¬í•˜ë©° ì—¬ê¸°ì„œ SortingOrderë¥¼ ë³´ê³  ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.
```cs
// Update()
float deltaTime = Time.deltaTime;
for (int i = 0; i < updatables.Count; i++)
{
    updatables[i].OnUpdate(deltaTime);
}

// FixedUpdate()
float fixedDeltaTime = Time.fixedDeltaTime;
for (int i = 0; i < fixedUpdatables.Count; i++)
{
    fixedUpdatables[i].OnFixedUpdate(fixedDeltaTime);
}

// LateUpdate()
 float deltaTime = Time.deltaTime;
 for (int i = 0; i < lateUpdatables.Count; i++)
 {
     lateUpdatables[i].OnLateUpdate(deltaTime);
 }
```

# ğŸ”„ ë°ì´í„° íë¦„
- ê°ì²´ ìƒì„±
- Initialize() â†’ Register() â†’ GameFlowManager ë“±ë¡ë¨
- GameFlowManagerê°€ ë§¤ í”„ë ˆì„ OnUpdate() í˜¸ì¶œ
- í•´ì œ ì‹œ Dispose() â†’ Unregister()(ìë™) â†’ GameFlowManager í•´ì œë¨
- ì†Œë©¸

# ğŸ¯ ì‹ ê²½ ì“´ ë¶€ë¶„
###### Pending System
Update ì‹¤í–‰ ì¤‘ì—ë„ ì•ˆì „í•˜ê²Œ ë“±ë¡/í•´ì œ ê°€ëŠ¥í•˜ë„ë¡ í–ˆë‹¤. 
ë”°ë¼ì„œ ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•´ë„ ë¬¸ì œê°€ ì—†ë‹¤.
```cs
public override void OnUpdate(float deltaTime)
{
    if (shouldSpawnEnemy)
    {
        var enemy = new Enemy();
        enemy.Initialize();  // ì´ ì•ˆì—ì„œ Register() í˜¸ì¶œ
        // Pending ì‹œìŠ¤í…œì´ ë‹¤ìŒ í”„ë ˆì„ì— ì•ˆì „í•˜ê²Œ ë“±ë¡
    }
}
```

Pending Systemì´ ë¬´ì—‡ì¸ê°€ í•˜ë©´ ë³„ê±´ ì•„ë‹ˆê³ 
ë°˜ë³µë¬¸ ì¤‘ì— ë¦¬ìŠ¤íŠ¸ ìˆ˜ì •ì„ í•´ë„ ë¬¸ì œ ì—†ë„ë¡ ì¼ë‹¨ ë©”ëª¨í•´ë’€ë‹¤ê°€ ë‚˜ì¤‘ì— ì²˜ë¦¬í•˜ë„ë¡ ë§Œë“¤ì—ˆë‹¤.

ìš”ì²­ì´ ë“¤ì–´ì™”ì„ ë•Œ, í˜„ì¬ Updateê°€ ì‹¤í–‰ì¤‘ì´ë¼ë©´ Pending ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€í•˜ê³ (ë©”ëª¨)
ì‹¤í–‰ì¤‘ì´ ì•„ë‹ˆë¼ë©´ ë°”ë¡œ ì¶”ê°€í•œë‹¤.
```cs
// ì§€ê¸ˆ Update ì‹¤í–‰ ì¤‘ì¸ê°€?
if (isUpdating)
{
	// ì‹¤í–‰ ì¤‘ì´ë©´ â†’ Pending ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ (ë©”ëª¨ë§Œ í•´ë‘ )
	if (!pendingAddUpdatables.Contains(updatable))
	{
		pendingAddUpdatables.Add(updatable);
		// "ì´ë”°ê°€ ì¶”ê°€í•´ì•¼ì§€~" ë©”ëª¨
	}
  }
else
{
	// ì‹¤í–‰ ì¤‘ì´ ì•„ë‹ˆë©´ â†’ ë°”ë¡œ ì¶”ê°€
	if (!updatables.Contains(updatable))
	{
		updatables.Add(updatable);
	}
}
```

ì´í›„ ì—…ë°ì´íŠ¸ ì‹¤í–‰ì—ì„œ Pendingëœ ë¦¬ìŠ¤íŠ¸ë“¤ë¶€í„° ë¨¼ì € ì—…ë°ì´íŠ¸ ë£¨í”„ì— í¸ìŠ¹ì‹œí‚¨ í›„ ì—…ë°ì´íŠ¸ë¥¼ ëŒë¦°ë‹¤.

ë˜í•œ ìƒˆ ê°ì²´ê°€ ë“±ë¡ë˜ë©´ Sort ì‹œìŠ¤í…œì„ ëŒë¦°ë‹¤.

##### ê²Œì„ ì¼ì‹œì •ì§€
IsPaused ìƒíƒœë¥¼ ë§Œë“¤ì–´ì„œ Updateë¥¼ ì¤‘ë‹¨í•˜ê²Œ ë§Œë“¤ì—ˆë‹¤.
ë”°ë¼ì„œ ë³„ë„ì˜ deltaTime ì¡°ì‘ ì—†ì´ë„ ì¼ì‹œì¤‘ì§€ê°€ ê°€ëŠ¥í•˜ë‹¤.

```cs
    private void Update()
    {
        // ì¼ì‹œì •ì§€ ìƒíƒœë©´ ì‹¤í–‰ ì¤‘ë‹¨
        if (_isPaused)
            return;
		
		(...)
	}
```

# ê²°ë¡ 
ì—¬ëŸ¬ëª¨ë¡œ ì“¸ëª¨ìˆëŠ” ì‹œìŠ¤í…œì„ ë§Œë“  ê²ƒ ê°™ë‹¤. ìŒ êµ¿!